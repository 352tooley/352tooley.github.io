<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Tracker</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS PWA basics -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#ffffff">
  <link rel="apple-touch-icon" href="logo-192.png">

  <!-- iOS startup images (upload PNGs with these exact names to repo root) -->
  <!-- iPhone SE / 5 / 5S -->
  <link rel="apple-touch-startup-image" href="splash-640x1136.png"
        media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPhone 6/7/8 -->
  <link rel="apple-touch-startup-image" href="splash-750x1334.png"
        media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPhone 6/7/8 Plus -->
  <link rel="apple-touch-startup-image" href="splash-1242x2208.png"
        media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPhone X / XS / 11 Pro -->
  <link rel="apple-touch-startup-image" href="splash-1125x2436.png"
        media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPhone XR / 11 -->
  <link rel="apple-touch-startup-image" href="splash-828x1792.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPhone XS Max / 11 Pro Max -->
  <link rel="apple-touch-startup-image" href="splash-1242x2688.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPhone 12 / 13 / 14 -->
  <link rel="apple-touch-startup-image" href="splash-1170x2532.png"
        media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPhone 12/13/14 Pro Max / 14 Plus -->
  <link rel="apple-touch-startup-image" href="splash-1284x2778.png"
        media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPhone 15 Pro Max / newer tall 3x -->
  <link rel="apple-touch-startup-image" href="splash-1290x2796.png"
        media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <!-- iPad 9.7" -->
  <link rel="apple-touch-startup-image" href="splash-1536x2048.png"
        media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPad 10.2" -->
  <link rel="apple-touch-startup-image" href="splash-1620x2160.png"
        media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPad Pro 10.5" -->
  <link rel="apple-touch-startup-image" href="splash-1668x2224.png"
        media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPad Pro 11" -->
  <link rel="apple-touch-startup-image" href="splash-1668x2388.png"
        media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <!-- iPad Pro 12.9" -->
  <link rel="apple-touch-startup-image" href="splash-2048x2732.png"
        media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <style>
    :root {
      --magenta:#d6006e; --ink:#111; --muted:#666; --bg:#fafafa; --card:#fff; --border:#e5e7eb;
    }
    html,body { height:100%; margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); }
    body { display:flex; align-items:center; justify-content:center; }

    /* In-app splash (2s, white background, centered logo) */
    #splash {
      position:fixed; inset:0; background:#fff;
      display:flex; align-items:center; justify-content:center; z-index:9999;
    }
    #splash img { width:38vw; max-width:260px; height:auto; }

    /* Sticky small logo (every screen) */
    .logo-small {
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      width:100px; height:auto; z-index:50;
    }

    /* Card */
    .card {
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      padding:26px 20px; width:min(92vw, 560px); box-shadow:0 8px 20px rgba(0,0,0,.06);
    }
    h1 { margin:0 0 14px; font-size:22px; color:var(--magenta); text-align:center; }

    /* Form */
    .row { display:flex; flex-direction:column; gap:10px; }
    select, button {
      font-size:16px; padding:12px; border-radius:10px; border:1px solid var(--border); width:100%;
    }
    select:disabled { background:#f4f4f4; color:#9a9a9a; }
    button { background:var(--magenta); color:#fff; border:none; cursor:pointer; font-weight:700; }
    button:disabled { background:#e1e1e1; color:#888; cursor:not-allowed; }
    .muted { font-size:14px; color:var(--muted); text-align:center; }

    @media (min-width:900px){
      #splash img { width:260px; }
      .logo-small { width:110px; }
    }
  </style>

  <!-- OneSignal v16 SDK -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>
<body>
  <!-- In-app splash -->
  <div id="splash">
    <img src="logo-512.png" alt="Company Logo">
  </div>

  <!-- Sticky small logo -->
  <img class="logo-small" src="logo-192.png" alt="Company Logo">

  <!-- Main card -->
  <main class="card" id="mainApp" style="display:none">
    <h1>Select Your Store</h1>

    <div class="row" style="margin-bottom:14px">
      <select id="regionSelect" disabled>
        <option value="">Select Region</option>
      </select>
      <select id="districtSelect" disabled>
        <option value="">Select District</option>
      </select>
      <select id="storeSelect" disabled>
        <option value="">Select Store</option>
      </select>
    </div>

    <div class="row">
      <button id="btnEnable">ðŸ”” Enable Notifications</button>
      <button id="btnSkip" style="background:#333">No thanks</button>
      <div id="status" class="muted">Checking subscription...</div>
    </div>
  </main>

  <script>
    // -------- In-app splash (2s) --------
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
      }, 2000);
    });

    // -------- Dropdown data (plug your real tree later) --------
    // Structure example:
    // { "South": { "Southwest": { "DFW West": ["Cleburne","Rufe Snow", ...] } } }
    const DATA_TREE = {}; // <- Fill later with your full hierarchy

    const regionSel   = document.getElementById('regionSelect');
    const districtSel = document.getElementById('districtSelect');
    const storeSel    = document.getElementById('storeSelect');

    function setDisabled(el, state){ el.disabled = state; el.style.opacity = state ? 0.8 : 1; }

    function fillOptions(selectEl, items, placeholder){
      selectEl.innerHTML = `<option value="">${placeholder}</option>`;
      items.forEach(v=>{
        const opt = document.createElement('option');
        opt.value = v; opt.textContent = v;
        selectEl.appendChild(opt);
      });
    }

    function loadPersisted(){
      const r = localStorage.getItem('region');
      const d = localStorage.getItem('district');
      const s = localStorage.getItem('store');

      // Regions
      const regions = Object.keys(DATA_TREE);
      fillOptions(regionSel, regions, 'Select Region');
      setDisabled(regionSel, regions.length===0);

      if(r && regions.includes(r)){
        regionSel.value = r;
        onRegion();
        const districts = Object.keys(DATA_TREE[r] || {});
        if(d && districts.includes(d)){
          districtSel.value = d;
          onDistrict();
          const stores = (DATA_TREE[r]?.[d]) || [];
          if(s && stores.includes(s)){
            storeSel.value = s;
          }
        }
      }
    }

    function onRegion(){
      const r = regionSel.value;
      localStorage.setItem('region', r || '');
      if(!r){
        fillOptions(districtSel, [], 'Select District');
        fillOptions(storeSel, [], 'Select Store');
        setDisabled(districtSel, true);
        setDisabled(storeSel, true);
        return;
      }
      const districts = Object.keys(DATA_TREE[r] || []);
      fillOptions(districtSel, districts, 'Select District');
      setDisabled(districtSel, districts.length===0);
      // Reset stores
      fillOptions(storeSel, [], 'Select Store');
      setDisabled(storeSel, true);
      localStorage.removeItem('district'); localStorage.removeItem('store');
    }

    function onDistrict(){
      const r = regionSel.value;
      const d = districtSel.value;
      localStorage.setItem('district', d || '');
      if(!r || !d){
        fillOptions(storeSel, [], 'Select Store');
        setDisabled(storeSel, true);
        return;
      }
      const stores = (DATA_TREE[r]?.[d]) || [];
      fillOptions(storeSel, stores, 'Select Store');
      setDisabled(storeSel, stores.length===0);
      localStorage.removeItem('store');
    }

    function onStore(){
      localStorage.setItem('store', storeSel.value || '');
    }

    regionSel.addEventListener('change', onRegion);
    districtSel.addEventListener('change', onDistrict);
    storeSel.addEventListener('change', onStore);

    // boot dropdowns (empty tree means Region locked)
    loadPersisted();

    // If you already have your tree handy, assign it then call loadPersisted() again:
    // DATA_TREE = {...}; loadPersisted();

    // -------- OneSignal setup --------
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      try {
        await OneSignal.init({ appId: "5ecaba08-de2f-44b8-a4f0-369508265505" });

        const btn = document.getElementById('btnEnable');
        const skip = document.getElementById('btnSkip');
        const status = document.getElementById('status');

        async function refreshStatus(){
          const opted = await OneSignal.User.PushSubscription.optedIn;
          if(opted){
            status.innerHTML = "âœ… Notifications Enabled";
            btn.disabled = true; btn.textContent = "Enabled";
          } else {
            status.textContent = "Not Subscribed";
            btn.disabled = false; btn.textContent = "ðŸ”” Enable Notifications";
          }
        }

        btn.addEventListener('click', async ()=>{
          try{
            await OneSignal.Slidedown.promptPush();
          }catch(e){}
          refreshStatus();
        });

        skip.addEventListener('click', ()=>{
          status.textContent = "Notifications skipped";
          btn.disabled = true; skip.disabled = true;
        });

        refreshStatus();
      } catch (e) {
        document.getElementById('status').textContent = "Init error: " + (e && e.message ? e.message : e);
      }
    });
  </script>
</body>
</html>
