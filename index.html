
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Goals & Gaps Tracker</title>
  <link rel="manifest" href="/manifest.json">
  <style>
    :root{
      --pink:#e20074;
      --card:#ffffff;
      --bg:#f7f7fb;
      --text:#1a1a1a;
      --muted:#9aa3af;
      --radius:20px;
    }
    html,body{height:100%;}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      display:flex;
      justify-content:center;
      align-items:flex-end;
      padding:12px 16px 0;
    }
    .logo{
      /* Cropped logo slot. If you already have a data URI, replace below */
      width:min(680px, 92vw);
      height:auto;
      aspect-ratio: 1320/350;
      background-repeat:no-repeat;
      background-position:center;
      background-size:contain;
      /* Embedded lightweight SVG placeholder that says CONNECTIVITY SOURCE in brand colors.
         Replace data URI with your real base64 PNG if desired. */
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1320 350'><rect width='100%' height='100%' fill='white'/><text x='50%' y='60%' dominant-baseline='middle' text-anchor='middle' font-family='Helvetica, Arial, sans-serif' font-size='120' font-weight='700' fill='black' opacity='0.75'>CONNECTIVITY</text><text x='73%' y='78%' dominant-baseline='middle' text-anchor='middle' font-family='Helvetica, Arial, sans-serif' font-size='110' font-weight='700' fill='%23e20074' opacity='0.85'>SOURCE</text></svg>");
      border-radius:14px;
    }
    .card{
      width:min(760px, 92vw);
      margin:8px auto 28px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 6px 26px rgba(16,24,40,.08);
      padding:20px 18px 24px;
    }
    h1{
      margin:10px 0 6px;
      text-align:center;
      color:var(--pink);
      font-size:clamp(22px, 4.8vw, 30px);
    }
    h2{
      margin:0 0 14px;
      text-align:center;
      font-size:clamp(18px, 4vw, 24px);
    }
    label{
      display:block;
      font-weight:600;
      margin:16px 8px 6px;
    }
    select{
      width:100%;
      appearance:none;
      -webkit-appearance:none;
      font-size:17px;
      padding:14px 16px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#f8fafc;
    }
    .row{display:block;}
    button{
      width:100%;
      margin-top:18px;
      padding:14px 16px;
      border:0;
      border-radius:14px;
      background:var(--pink);
      color:white;
      font-size:20px;
      font-weight:800;
      letter-spacing:.3px;
      box-shadow:0 16px 28px rgba(226,0,116,.28);
    }
    button:disabled{
      background:#e5e7eb;
      color:#9aa3af;
      box-shadow:none;
    }
    .hint{
      margin-top:10px;
      text-align:center;
      color:#6b7280;
      font-size:14px;
    }
    .debug{
      margin:4px auto;
      text-align:center;
      font-size:12px;
      color:#9aa3af;
      max-width:min(760px,92vw);
    }
  </style>
</head>
<body>
  <header><div class="logo" aria-label="Connectivity Source logo"></div></header>
  <main class="card">
    <h1>Goals & Gaps Tracker</h1>
    <h2>Select Your Store</h2>
    <div class="row">
      <label for="areaSelect">Area</label>
      <select id="areaSelect"><option value="">Select Area</option></select>

      <label for="regionSelect">Region</label>
      <select id="regionSelect" disabled><option value="">Select Region</option></select>

      <label for="districtSelect">District</label>
      <select id="districtSelect" disabled><option value="">Select District</option></select>

      <label for="storeSelect">Store</label>
      <select id="storeSelect" disabled><option value="">Select Store</option></select>

      <button id="goBtn" disabled>DORT â†’</button>
      <div class="hint">Your selections are saved on this device.</div>
    </div>
  </main>
  <div class="debug" id="debug"></div>
  <script>
    (function(){
      const areaSel = document.getElementById('areaSelect');
      const regionSel = document.getElementById('regionSelect');
      const districtSel = document.getElementById('districtSelect');
      const storeSel = document.getElementById('storeSelect');
      const goBtn = document.getElementById('goBtn');
      const debug = document.getElementById('debug');

      const uniq = arr => [...new Set(arr.filter(Boolean))].sort((a,b)=>a.localeCompare(b));
      const getAny = (obj, keys) => {
        for(const k of keys){ if(obj && obj[k] != null && String(obj[k]).trim() !== '') return String(obj[k]).trim(); }
        return '';
      };

      function buildIndex(rows){
        const map = {}; // area -> region -> district -> [stores]
        for(const r of rows){
          const area = getAny(r, ['Area','area','AREA','Area Name','AreaName']);
          const region = getAny(r, ['Region','region','REGION']);
          const district = getAny(r, ['District','district','DISTRICT']);
          const store = getAny(r, ['Store','store','StoreName','storeName','STORE','STORE NAME','Store Name','D']);
          if(!area || !region || !district || !store) continue;
          map[area] ??= {};
          map[area][region] ??= {};
          map[area][region][district] ??= [];
          map[area][region][district].push(store);
        }
        return map;
      }

      function populateAreas(map){
        areaSel.innerHTML = '<option value="">Select Area</option>';
        for(const a of uniq(Object.keys(map))){
          const opt = document.createElement('option');
          opt.value = opt.textContent = a;
          areaSel.appendChild(opt);
        }
        regionSel.disabled = districtSel.disabled = storeSel.disabled = true;
        goBtn.disabled = true;
      }

      function populateRegions(map, area){
        regionSel.innerHTML = '<option value="">Select Region</option>';
        districtSel.innerHTML = '<option value="">Select District</option>';
        storeSel.innerHTML = '<option value="">Select Store</option>';
        if(!area){ regionSel.disabled = districtSel.disabled = storeSel.disabled = true; return; }
        const regMap = map[area] || {};
        for(const r of uniq(Object.keys(regMap))){
          const opt = document.createElement('option');
          opt.value = opt.textContent = r;
          regionSel.appendChild(opt);
        }
        regionSel.disabled = false;
        districtSel.disabled = storeSel.disabled = true;
        goBtn.disabled = true;
      }

      function populateDistricts(map, area, region){
        districtSel.innerHTML = '<option value="">Select District</option>';
        storeSel.innerHTML = '<option value="">Select Store</option>';
        if(!area || !region){ districtSel.disabled = storeSel.disabled = true; return; }
        const distMap = (map[area]||{})[region] || {};
        for(const d of uniq(Object.keys(distMap))){
          const opt = document.createElement('option');
          opt.value = opt.textContent = d;
          districtSel.appendChild(opt);
        }
        districtSel.disabled = false;
        storeSel.disabled = true;
        goBtn.disabled = true;
      }

      function populateStores(map, area, region, district){
        storeSel.innerHTML = '<option value="">Select Store</option>';
        if(!area || !region || !district){ storeSel.disabled = true; return; }
        const stores = uniq(((map[area]||{})[region]||{})[district] || []);
        for(const s of stores){
          const opt = document.createElement('option');
          opt.value = opt.textContent = s;
          storeSel.appendChild(opt);
        }
        storeSel.disabled = false;
        goBtn.disabled = true;
      }

      function saveAndGo(path){
        const sel = {
          area: areaSel.value || '',
          region: regionSel.value || '',
          district: districtSel.value || '',
          store: storeSel.value || ''
        };
        try{ localStorage.setItem('ggt_selection', JSON.stringify(sel)); }catch(e){}
        location.href = path;
      }

      // Attach handlers
      areaSel.addEventListener('change', ()=>{
        populateRegions(window.__GG_MAP, areaSel.value);
      });
      regionSel.addEventListener('change', ()=>{
        populateDistricts(window.__GG_MAP, areaSel.value, regionSel.value);
      });
      districtSel.addEventListener('change', ()=>{
        populateStores(window.__GG_MAP, areaSel.value, regionSel.value, districtSel.value);
      });
      storeSel.addEventListener('change', ()=>{
        goBtn.disabled = !storeSel.value;
      });

      goBtn.addEventListener('click', ()=> saveAndGo(window.__GG_NEXT));

      async function tryFetch(url){
        try{
          const res = await fetch(url, {cache:'no-store'});
          if(!res.ok) throw new Error(res.status+' '+res.statusText);
          const data = await res.json();
          return data;
        }catch(e){
          return null;
        }
      }

      async function loadData(){
        const tried = [];
        for(const url of window.__GG_SOURCES){
          tried.push(url);
          const data = await tryFetch(url);
          if(data && Array.isArray(data) && data.length){
            debug.textContent = 'Loaded locations from: ' + url;
            const map = buildIndex(data);
            window.__GG_MAP = map;
            populateAreas(map);
            return;
          }
        }
        debug.textContent = 'Could not load locations.json. Tried: ' + tried.join('  |  ');
      }

      loadData();
    })();
  </script>

<script>
  // For ROOT index
  window.__GG_SOURCES = [
    '/app/locations.json?nocache=' + Date.now(),
    '/locations.json?nocache=' + Date.now(),
    './locations.json?nocache=' + Date.now()
  ];
  window.__GG_NEXT = '/app/dort.html';
</script>
</body>
</html>
