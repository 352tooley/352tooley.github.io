// app/app.js â€” dropdowns + notifications (OneSignal v16)
// App ID embedded; safe to ignore if you don't use notifications.
(function(){const APP_ID="5ecaba08-de2f-44b8-a4f0-369508265505";const e=document.getElementById("enableBtn"),t=document.getElementById("skipBtn"),n=document.getElementById("notifStatus");const s=(t,s)=>{n&&(n.textContent=t||"",n.style.color="ok"===s?"#0a7a0a":"warn"===s?"#b85d00":"#666")},o=(t,n)=>{e&&(e.disabled=!!t,n&&(e.textContent=n))},a="push_skip",i=()=>"1"===localStorage.getItem(a),l=t=>localStorage.setItem(a,t?"1":"0");if(e&&t&&n){i()?(o(!0,"Notifications Off"),s("You chose not to enable notifications. You can enable later.","warn")):(o(!1,"ðŸ”” Enable notifications"),s("Notifications are optional.",""));function d(){return new Promise((n,s)=>{if(window.OneSignal)return n();window.OneSignalDeferred=window.OneSignalDeferred||[];const o=document.createElement("script");o.src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js",o.defer=!0,o.onload=n,o.onerror=(()=>s(new Error("Failed to load OneSignal SDK"))),document.head.appendChild(o)})}async function c(){try{return await d(),await new Promise((e=>{window.OneSignalDeferred.push(async function(e){await e.init({appId:APP_ID}),setTimeout(()=>{const t=document.querySelector(".onesignal-slidedown-dialog");t&&(t.style.zIndex=9999)},0)}),e()})),!0}catch(e){return s("Notifications unavailable on this device/browser.","warn"),!1}}async function r(){try{if(!window.OneSignal)return;const t=await OneSignal.User.PushSubscription.optedIn;if(t){const t=await OneSignal.User.PushSubscription.id;o(!0,"Notifications Enabled"),s("Subscribed"+(t?` (Player ID: ${t})`:""),"ok")}else i()||(o(!1,"ðŸ”” Enable notifications"),s("Not subscribed â€” tap Enable notifications.","warn"))}catch(e){}}e.addEventListener("click",async()=>{if(i())return void s("You previously chose No thanks. Refresh the page to try enabling.","warn");o(!0,"Enablingâ€¦");const t=await c();t?(await OneSignal.Slidedown.promptPush(),await r()):o(!1,"ðŸ”” Enable notifications")}),t.addEventListener("click",()=>{l(!0),o(!0,"Notifications Off"),s("You chose not to enable notifications. You can re-enable next visit.","warn")}),async function(){const e=await c();e&&await r()}()}const E=document.getElementById("areaSelect"),u=document.getElementById("regionSelect"),m=document.getElementById("districtSelect"),g=document.getElementById("storeSelect"),h=document.getElementById("goDort");function p(e,t,n){e&&(e.innerHTML=`<option disabled selected>${n||"Select"}</option>`,(t||[]).forEach((t=>e.insertAdjacentHTML("beforeend",`<option value="${t}">${t}</option>`))))}function v(e,t){e&&(e.disabled=!!t,e.style.opacity=t?.85:1)}function f(){E&&localStorage.setItem("sel_area",E.value||""),u&&localStorage.setItem("sel_region",u.value||""),m&&localStorage.setItem("sel_district",m.value||""),g&&localStorage.setItem("sel_store",g.value||"")}const DATA_TREE={};function y(){if(!E||!u||!m||!g)return;const e=Object.keys(DATA_TREE||{});p(E,e,"Select Area"),v(E,0===e.length);const t=localStorage.getItem("sel_area"),n=localStorage.getItem("sel_region"),s=localStorage.getItem("sel_district"),o=localStorage.getItem("sel_store");t&&DATA_TREE[t]&&(E.value=t,b(),n&&DATA_TREE[t][n]&&(u.value=n,S(),s&&DATA_TREE[t][n][s]&&(m.value=s,L(),o&&Array.from(g.options).some((e=>e.value===o))&&(g.value=o)))),h&&(h.disabled=!(g&&g.value))}function b(){if(!E||!u||!m||!g)return;const e=E.value;f();if(!e)return p(u,[],"Select Region"),v(u,!0),p(m,[],"Select District"),v(m,!0),p(g,[],"Select Store"),v(g,!0),void(h&&(h.disabled=!0));const t=Object.keys(DATA_TREE[e]||{});p(u,t,"Select Region"),v(u,0===t.length),p(m,[],"Select District"),v(m,!0),p(g,[],"Select Store"),v(g,!0),h&&(h.disabled=!0),localStorage.removeItem("sel_region"),localStorage.removeItem("sel_district"),localStorage.removeItem("sel_store")}function S(){if(!E||!u||!m||!g)return;const e=E.value,t=u.value;f();if(!(e&&t))return p(m,[],"Select District"),v(m,!0),p(g,[],"Select Store"),v(g,!0),void(h&&(h.disabled=!0));const n=Object.keys((DATA_TREE[e]||{})[t]||{});p(m,n,"Select District"),v(m,0===n.length),p(g,[],"Select Store"),v(g,!0),h&&(h.disabled=!0),localStorage.removeItem("sel_district"),localStorage.removeItem("sel_store")}function L(){if(!E||!u||!m||!g)return;const e=E.value,t=u.value,n=m.value;f();if(!(e&&t&&n))return p(g,[],"Select Store"),v(g,!0),void(h&&(h.disabled=!0));const s=((DATA_TREE[e]||{})[t]||{})[n]||[];p(g,s,"Select Store"),v(g,0===s.length),h&&(h.disabled=!0),localStorage.removeItem("sel_store")}function D(){f(),h&&(h.disabled=!(g&&g.value))}E&&E.addEventListener("change",b),u&&u.addEventListener("change",S),m&&m.addEventListener("change",L),g&&g.addEventListener("change",D),y();})();